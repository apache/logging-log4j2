<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuration :: Apache Log4j</title>
    <link rel="canonical" href="https://logging.apache.org/log4j/3.x/manual/configuration.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
<link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/../_images/favicon.ico" type="image/x-icon">
<!-- `@asciidoctor/tabs` extension styles -->
<link rel="stylesheet" href="../_/css/vendor/tabs.css">
<style>
  /* Default `h4` and `h5` are smaller than the normal text, fix header font sizing: */
  .doc h1 { font-size: 1.9rem; }
  .doc h2 { font-size: 1.7rem; }
  .doc h3 { font-size: 1.5rem; font-weight: 400; }
  .doc h4 { font-size: 1.3rem; font-weight: 500; }
  .doc h5 { font-size: 1.1rem; font-weight: 500; text-decoration: underline; }
  /* Default `code`, `pre`, and `.colist` (source code annotations) fonts are too big, adjust them: */
  .doc .colist>table code, .doc p code, .doc thead code { font-size: 0.8em; }
  .doc pre { font-size: 0.7rem; }
  .doc .colist { font-size: 0.75rem; }
  /* Tab header fonts aren't rendered good, adjusting the font weight: */
  .tablist > ul li { font-weight: 500; } 
  /* `page-toclevels` greater than 4 are not supported by Antora UI, patching it: */
  .toc .toc-menu li[data-level="4"] a {
    padding-left: 2.75rem
  }
  /* Replace the default highlight.js color for strings from red (unnecessarily signaling something negative) to green: */
  .hljs-string {
    color: #0f8532;
  }
</style>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <img src="../_/../_images/logo-small-white.png" alt="Apache Log4j"/>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://logging.apache.org">a subproject of&nbsp;<strong>Apache Logging Services</strong></a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Home</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../download.html">Download</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../runtime-dependencies.html">Runtime Dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../release-notes.html">Release Notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="https://logging.apache.org/support.html">Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://logging.apache.org/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../thanks.html">Thanks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Learn</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Manual</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="migration.html">Migrating from Log4j 1.x to 2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="api.html">Log4j API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="logbuilder.html">Log Builder</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="flowtracing.html">Flow Tracing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="markers.html">Markers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="eventlogging.html">Event Logging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="messages.html">Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="thread-context.html">Thread Context</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="scoped-context.html">Scoped Context</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="resource-logger.html">Resource Logging</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cloud.html">Using Log4j in Cloud Enabled Applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lookups.html">Lookups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appenders.html">Appenders</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="layouts.html">Layouts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="json-template-layout.html">JSON Template Layout</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="filters.html">Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="async.html">Lock-free Asynchronous Loggers for Low-Latency Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="garbagefree.html">Garbage-free Steady State Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="extending.html">Extending Log4j 3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="customconfig.html">Programmatic Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="customloglevels.html">Custom Log Levels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jmx.html">JMX</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="logsep.html">Logging Separation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="performance.html">Performance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../plugin-reference.html">Plugin reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javadoc.html">Java API reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../articles.html">Articles</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">F.A.Q.</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../development.html">Development</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-api.html">Log4j API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-1.2-api.html">Log4j 1.2 Bridge</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-slf4j-impl.html">Log4j SLF4J Binding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-jul.html">Log4j JDK Logging Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-jpl.html">Log4j JDK Platform Logging Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-to-slf4j.html">Log4j to SLF4J Adapter</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-flume-ng.html">Flume Appender</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#log4j-mongodb.adoc">log4j-mongodb.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-iostreams.html">Log4j IOStreams</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-docker.html">Log4j Docker Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../log4j-spring-cloud-config-client.html">Log4j Spring Cloud Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Related projects</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/jakarta">Log4j Jakarta EE</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/jmx-gui">Log4j JMX GUI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/kotlin">Log4j Kotlin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/scala">Log4j Scala</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/tools">Log4j Tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="/log4j/transform">Log4j Transformation Tools</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Home</a></li>
    <li>Learn</li>
    <li><a href="index.html">Manual</a></li>
    <li><a href="configuration.html">Configuration</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/apache/logging-log4j2/edit/main/src/site/antora/modules/ROOT/pages/manual/configuration.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="4">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Inserting log requests into the application code requires a fair amount
of planning and effort. Observation shows that approximately 4 percent
of code is dedicated to logging. Consequently, even moderately sized
applications will have thousands of logging statements embedded within
their code. Given their number, it becomes imperative to manage these
log statements without the need to modify them manually.</p>
</div>
<div class="paragraph">
<p>Configuration of Log4j 2 can be accomplished in 1 of 4 ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Through a configuration file written in XML, JSON, YAML, or
properties format.</p>
</li>
<li>
<p>Programmatically, by creating a ConfigurationFactory and
Configuration implementation.</p>
</li>
<li>
<p>Programmatically, by calling the APIs exposed in the Configuration
interface to add components to the default configuration.</p>
</li>
<li>
<p>Programmatically, by calling methods on the internal Logger class.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This page focuses primarily on configuring Log4j through a configuration
file. Information on programmatically configuring Log4j can be found at
<a href="extending.html" class="xref page">Extending Log4j 2</a> and
<a href="customconfig.html" class="xref page">Programmatic Log4j Configuration</a>.</p>
</div>
<div class="paragraph">
<p>All available formats are functionally equivalent. For example, a
configuration file in XML can be rewritten using the properties format
(and the opposite) without any loss of functionality. However, the
hierarchical nature of a Log4j configuration can be captured better in
formats which naturally support nesting so XML, JSON, and YAML files,
are usually easier to use.</p>
</div>
<div class="paragraph">
<p>Note that unlike Log4j 1.x, the public Log4j 2 API does not expose
methods to add, modify or remove appenders and filters or manipulate the
configuration in any way.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Architecture"><a class="anchor" href="#Architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In part because support for XML was added first, Log4j&#8217;s configuration is reflected as a tree structure.
In fact every configuration dialect, including the ConfigurationBuilder, generates a Node for every
configuration element. A node is a fairly simple structure that contains a set of attributes, a set of
child nodes and a PluginType. It is important to note that every Node must have a corresponding plugn,
as the plugin is the component that actually performs the work represented by the node.</p>
</div>
<div class="paragraph">
<p>Every document type supported by Log4j has a ConfigurationFactory. The factory itself is a Log4j plugin
that declares what file extensions it supports and what its priority is. Properties have the highest
precedence with a value of 8, followed by yaml, json and xml. When autoconfiguration is performed Log4j
will call each of these factories in order to determine which, if any, support the specified configuration
file format. If one is found that factory will create the corresponding Configuratoin object and pass the
reference to the configuration data to it.</p>
</div>
<div class="paragraph">
<p>Every configuration implementation, such as XMLConfiguration, YamlConfiguration, JsonConfiguration, etc.
has the primary task of converting the configuration text into the Node tree, typically by parsing the
text with whatever tool is available for that document type. It should be noted that while most of the
supported document types are inherintly tree structured, the Java properties syntax is not. Because of the
need to convert the syntax into a Node tree the Java properties syntax used by Log4j required all properties
follow a naming pattern that made the tree structure clear. As a consequence, the Java Properties format
tends to be more verbose than using a different document type.</p>
</div>
<div class="paragraph">
<p>Once the Node tree is created control is delegated to AbstractConfiguration, which convertes the Nodes into
their respective Java objects using Log4j&#8217;s Plugin system and provides all the common functionality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Arbiters"><a class="anchor" href="#Arbiters"></a>Arbiters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some situations it is desirable to have a single logging configuration that can be used in any
deployment environment. For example, it may be necessary to have a different default logging level in
production then in development. Another case might be where one type of appender is used when running
natively but another is used when deployed to a docker container. One way to handle that is to use
a tool such as Spring Cloud Config Server that can be environment aware and serve a different file for
each environment. Another option is to include Arbiters in the configuration.</p>
</div>
<div class="paragraph">
<p>An Arbiter is a Log4j plugin that has the job of determining whether other configured elements should be
included in the generated configuration. While all other "Core" plugins are designed to execute as part of
Log4j&#8217;s runtime logic Arbiters execute after the Node tree has been constructed but before the tree is
converted to a configuration. An Arbiter is a Node itself which is always removed from the Node tree
before it the tree is processed. All an arbiter really does is provide a method that returns a boolean
result that determines whether the child nodes of the arbiter should remain in the configuration or be
pruned.</p>
</div>
<div class="paragraph">
<p>Arbiters may occur anywhere an element is allowed in the configuration. So an Aribiter could encapsulate
something as simple as a single property declaration or a whole set of Appenders or Loggers. Arbiters
may also be nested although Arbiters that are the descendant of another arbiter will only be evalued if the
ancestor returned true. The child elements of an Arbiter must be valid elements for whatever element is
the parent of the Arbiter.</p>
</div>
<div class="paragraph">
<p>This example shows two Arbiters configured that will include either a Console Appender or a List Appender
depending on whether the value of the env System Property is "dev" or "prod".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration name="ConfigTest" status="ERROR" monitorInterval="5"&gt;
  &lt;Appenders&gt;

    &lt;SystemPropertyArbiter propertyName="env" propertyValue="dev"&gt;
      &lt;Console name="Out"&gt;
        &lt;PatternLayout pattern="%m%n"/&gt;
      &lt;/Console&gt;
    &lt;/SystemPropertyArbiter&gt;
    &lt;SystemPropertyArbiter propertyName="env" propertyValue="prod"&gt;
      &lt;List name="Out"&gt;
      &lt;/List&gt;
    &lt;/SystemPropertyArbiter&gt;

  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="org.apache.test" level="trace" additivity="false"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Logger&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally Arbiters act in isolation from other Arbiters. That is, the outcome of one Arbiter will not
impact any other Arbiters. This can be cumbersome when you simply want to use one of a set of choices. A
special plugin named "Select" can be used in this case. Each element under the Select is required to be
an Arbiter. The first Arbiter that returns a true value will be the one used while others are ignored.
If no Arbiter returns true a DefaultAtrbiter may be configured with the default configuration elements.
The DefaultArbiter is an Arbiter that always returns true, so using it outside of a Select would result in
its configured elements always being included just as if it hadn&#8217;t been present.</p>
</div>
<div class="paragraph">
<p>This example shows an Arbiter that uses Javascript residing in a separate file to determine whether to
include the Console Appender. If the result is false then a List Appender will be included.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration name="ConfigTest" status="ERROR" monitorInterval="5"&gt;
  &lt;Appenders&gt;
    &lt;Select&gt;
      &lt;ScriptArbiter&gt;
        &lt;ScriptFile language="JavaScript" path="src/test/resources/scripts/prodtest.js" charset="UTF-8" /&gt;
        &lt;Console name="Out"&gt;
          &lt;PatternLayout pattern="%m%n"/&gt;
        &lt;/Console&gt;
      &lt;/ScriptArbiter&gt;
      &lt;DefaultArbiter&gt;
        &lt;List name="Out"&gt;
        &lt;/List&gt;
      &lt;/DefaultArbiter&gt;
    &lt;/Select&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="org.apache.test" level="trace" additivity="false"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Logger&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Natively Log4j contains the SystemProperty Arbiter that can evaluate whether to include elements based on
whether a SystemProperty is non-null or has a specific value, a ClassArbiter that makes its decision
based on whether the specified class is present, and a ScriptArbiter that makes its decision based
on the result of the script configured with it.</p>
</div>
<div class="paragraph">
<p>For Spring Boot users an Arbiter named &lt;code&gt;SpringProfile&lt;/code&gt; has been provided. The specified profiles
are evaluated by Spring&#8217;s &lt;code&gt;Environment.acceptsProfiles()&lt;/code&gt; method, so any expressions it supports
may be used as the name attribute.</p>
</div>
<div class="paragraph">
<p>This example will use a Console Appender when the Spring profile is "dev" or "staging" and a List
Appender when the active profile is "prod".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration name="ConfigTest" status="ERROR" monitorInterval="5"&gt;
  &lt;Appenders&gt;

    &lt;SpringProfile name="dev | staging"&gt;
      &lt;Console name="Out"&gt;
        &lt;PatternLayout pattern="%m%n"/&gt;
      &lt;/Console&gt;
    &lt;/SpringProfile&gt;
    &lt;SpringProfile name="prod"&gt;
      &lt;List name="Out"&gt;
      &lt;/List&gt;
    &lt;/SpringProfile&gt;

  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="org.apache.test" level="trace" additivity="false"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Logger&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Out"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AutomaticConfiguration"><a class="anchor" href="#AutomaticConfiguration"></a>Automatic Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j has the ability to automatically configure itself during
initialization. When Log4j starts it will locate all the
ConfigurationFactory plugins and arrange them in weighted order from
highest to lowest. As delivered, Log4j contains four
ConfigurationFactory implementations: one for JSON, one for YAML, one
for properties, and one for XML.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log4j will inspect the <code>"log4j2.configurationFile"</code> system property
and, if set, will attempt to load the configuration using the
<code>ConfigurationFactory</code> that matches the file extension. Note that this
is not restricted to a location on the local file system and may contain
a URL.</p>
</li>
<li>
<p>If no system property is set the properties ConfigurationFactory
will look for <code>log4j2-test.properties</code> in the classpath.</p>
</li>
<li>
<p>If no such file is found the YAML ConfigurationFactory will look for
<code>log4j2-test.yaml</code> or <code>log4j2-test.yml</code> in the classpath.</p>
</li>
<li>
<p>If no such file is found the JSON ConfigurationFactory will look for
<code>log4j2-test.json</code> or <code>log4j2-test.jsn</code> in the classpath.</p>
</li>
<li>
<p>If no such file is found the XML ConfigurationFactory will look for
<code>log4j2-test.xml</code> in the classpath.</p>
</li>
<li>
<p>If a test file cannot be located the properties ConfigurationFactory
will look for <code>log4j2.properties</code> on the classpath.</p>
</li>
<li>
<p>If a properties file cannot be located the YAML ConfigurationFactory
will look for <code>log4j2.yaml</code> or <code>log4j2.yml</code> on the classpath.</p>
</li>
<li>
<p>If a YAML file cannot be located the JSON ConfigurationFactory will
look for <code>log4j2.json</code> or <code>log4j2.jsn</code> on the classpath.</p>
</li>
<li>
<p>If a JSON file cannot be located the XML ConfigurationFactory will
try to locate <code>log4j2.xml</code> on the classpath.</p>
</li>
<li>
<p>If no configuration file could be located the <code>DefaultConfiguration</code>
will be used. This will cause logging output to go to the console.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An example application named <code>MyApp</code> that uses log4j can be used to
illustrate how this is done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.foo.Bar;

// Import log4j classes.
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.LogManager;

public class MyApp {

    // Define a static logger variable so that it references the
    // Logger instance named "MyApp".
    private static final Logger logger = LogManager.getLogger(MyApp.class);

    public static void main(final String... args) {

        // Set up a simple configuration that logs on the console.

        logger.trace("Entering application.");
        Bar bar = new Bar();
        if (!bar.doIt()) {
            logger.error("Didn't do it.");
        }
        logger.trace("Exiting application.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyApp</code> begins by importing log4j related classes. It then defines a
static logger variable with the name <code>MyApp</code> which happens to be the
fully qualified name of the class.</p>
</div>
<div class="paragraph">
<p><code>MyApp</code> uses the <code>Bar</code> class defined in the package`com.foo`.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.foo;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.LogManager;

public class Bar {
  static final Logger logger = LogManager.getLogger(Bar.class.getName());

  public boolean doIt() {
    logger.entry();
    logger.error("Did it again!");
    return logger.exit(false);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Log4j will provide a default configuration if it cannot locate a
configuration file. The default configuration, provided in the
DefaultConfiguration class, will set up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A
<a href="../javadoc/log4j-core/org/apache/logging/log4j/core/appender/ConsoleAppender.html"><code>ConsoleAppender</code></a>
attached to the root logger.</p>
</li>
<li>
<p>A
<a href="../javadoc/log4j-core/org/apache/logging/log4j/core/layout/PatternLayout.html"><code>PatternLayout</code></a>
set to the pattern "%d\{HH:mm:ss.SSS} [%t] %-5level %logger{36} -
%msg%n" attached to the ConsoleAppender</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that by default Log4j assigns the root logger to <code>Level.ERROR</code>.</p>
</div>
<div class="paragraph">
<p>The output of MyApp would be similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>17:13:01.540 [main] ERROR com.foo.Bar - Did it again!
17:13:01.540 [main] ERROR MyApp - Didn't do it.</pre>
</div>
</div>
<div class="paragraph">
<p>As was described previously, Log4j will first attempt to configure
itself from configuration files. A configuration equivalent to the
default would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="WARN"&gt;
  &lt;Appenders&gt;
    &lt;Console name="Console" target="SYSTEM_OUT"&gt;
      &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Console"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the file above is placed into the classpath as log4j2.xml you will
get results identical to those listed above. Changing the root level to
trace will result in results similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>17:13:01.540 [main] TRACE MyApp - Entering application.
17:13:01.540 [main] TRACE com.foo.Bar - entry
17:13:01.540 [main] ERROR com.foo.Bar - Did it again!
17:13:01.540 [main] TRACE com.foo.Bar - exit with (false)
17:13:01.540 [main] ERROR MyApp - Didn't do it.
17:13:01.540 [main] TRACE MyApp - Exiting application.</pre>
</div>
</div>
<div class="paragraph">
<p>Note that status logging is disabled when the default configuration is
used.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuration_From_a_URI"><a class="anchor" href="#Configuration_From_a_URI"></a>Configuration From a URI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <code>log4j2.configurationFile</code> references a URL, Log4j will first determine if the URL reference
a file using the file protocol. If it does Log4j will validate that the file URL is valid and continue
processing as previously described. If it contains a protocol other than file then Log4j will inspect
the value of the <code>log4j2.Configuration.allowedProtocols</code> system property. If the provided list
contains the protocol specified then Log4j will use the URI to locate the specified configuration file. If
not an exception will be thrown and an error message will be logged. If no value is provided for the
system property it will default to "https". Use of any protocol other than "file" can be prevented by
setting the system property value to "_none". This value would be an invalid protocol so cannot conflict
with any custom protocols that may be present.</p>
</div>
<div class="paragraph">
<p>Log4j supports access to remote URLs that require authentication. Log4j supports basic authentication
out of the box. If the <code>log4j2.Configuration.username</code> and <code>log4j2.Configuration.password</code>
are specified those values will be used to perform the authentication. If the password is encrypted a custom
password decryptor may be supplied by specifying the fully qualified class name in the
<code>log4j2.Configuration.passwordDecryptor</code> system property. A custom
<code>AuthenticationProvider</code> may be used by setting the
<code>log4j2.Configuration.authenticationProvider</code> system property to the fully qualified class name
of the provider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Additivity"><a class="anchor" href="#Additivity"></a>Additivity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perhaps it is desired to eliminate all the TRACE output from everything
except <code>com.foo.Bar</code>. Simply changing the log level would not accomplish
the task. Instead, the solution is to add a new logger definition to the
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration&gt;
  &lt;!-- ... --&gt;
  &lt;Logger name="com.foo.Bar" level="TRACE"/&gt;
  &lt;Root level="ERROR"&gt;
    &lt;AppenderRef ref="STDOUT"/&gt;
  &lt;/Root&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration all log events from <code>com.foo.Bar</code> will be
recorded while only error events will be recorded from all other
components.</p>
</div>
<div class="paragraph">
<p>In the previous example all the events from <code>com.foo.Bar</code> were still
written to the Console. This is because the logger for <code>com.foo.Bar</code> did
not have any appenders configured while its parent did. In fact, the
following configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="WARN"&gt;
  &lt;Appenders&gt;
    &lt;Console name="Console" target="SYSTEM_OUT"&gt;
      &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="com.foo.Bar" level="trace"&gt;
      &lt;AppenderRef ref="Console"/&gt;
    &lt;/Logger&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Console"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>would result in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>17:13:01.540 [main] TRACE com.foo.Bar - entry
17:13:01.540 [main] TRACE com.foo.Bar - entry
17:13:01.540 [main] ERROR com.foo.Bar - Did it again!
17:13:01.540 [main] TRACE com.foo.Bar - exit (false)
17:13:01.540 [main] TRACE com.foo.Bar - exit (false)
17:13:01.540 [main] ERROR MyApp - Didn't do it.</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the trace messages from <code>com.foo.Bar</code> appear twice. This is
because the appender associated with logger <code>com.foo.Bar</code> is first used,
which writes the first instance to the Console. Next, the parent of
<code>com.foo.Bar</code>, which in this case is the root logger, is referenced. The
event is then passed to its appender, which is also writes to the
Console, resulting in the second instance. This is known as additivity.
While additivity can be quite a convenient feature (as in the first
previous example where no appender reference needed to be configured),
in many cases this behavior is considered undesirable and so it is
possible to disable it by setting the additivity attribute on the logger
to false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="WARN"&gt;
  &lt;Appenders&gt;
    &lt;Console name="Console" target="SYSTEM_OUT"&gt;
      &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="com.foo.Bar" level="trace" additivity="false"&gt;
      &lt;AppenderRef ref="Console"/&gt;
    &lt;/Logger&gt;
    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="Console"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once an event reaches a logger with its additivity set to false the
event will not be passed to any of its parent loggers, regardless of
their additivity setting.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AutomaticReconfiguration"><a class="anchor" href="#AutomaticReconfiguration"></a>Automatic Reconfiguration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When configured from a File, Log4j has the ability to automatically
detect changes to the configuration file and reconfigure itself. If the
<code>monitorInterval</code> attribute is specified on the configuration element
and is set to a non-zero value then the file will be checked the next
time a log event is evaluated and/or logged and the monitorInterval has
elapsed since the last check. The example below shows how to configure
the attribute so that the configuration file will be checked for changes
only after at least 30 seconds have elapsed. The minimum interval is 5
seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration monitorInterval="30"&gt;
...
&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ChainsawSupport"><a class="anchor" href="#ChainsawSupport"></a>Chainsaw can automatically process your log files (Advertising appender configurations)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j provides the ability to 'advertise' appender configuration details
for all file-based appenders as well as socket-based appenders. For
example, for file-based appenders, the file location and the pattern
layout in the file are included in the advertisement. Chainsaw and other
external systems can discover these advertisements and use that
information to intelligently process the log file.</p>
</div>
<div class="paragraph">
<p>The mechanism by which an advertisement is exposed, as well as the
advertisement format, is specific to each Advertiser implementation. An
external system which would like to work with a specific Advertiser
implementation must understand how to locate the advertised
configuration as well as the format of the advertisement. For example, a
'database' Advertiser may store configuration details in a database
table. An external system can read that database table in order to
discover the file location and the file format.</p>
</div>
<div class="paragraph">
<p>Log4j provides one Advertiser implementation, a 'multicastdns'
Advertiser, which advertises appender configuration details via IP
multicast using the <a href="http://jmdns.sourceforge.net" class="bare">http://jmdns.sourceforge.net</a> library.</p>
</div>
<div class="paragraph">
<p>Chainsaw automatically discovers log4j&#8217;s multicastdns-generated
advertisements and displays those discovered advertisements in
Chainsaw&#8217;s Zeroconf tab (if the jmdns library is in Chainsaw&#8217;s
classpath). To begin parsing and tailing a log file provided in an
advertisement, just double-click the advertised entry in Chainsaw&#8217;s
Zeroconf tab. Currently, Chainsaw only supports FileAppender
advertisements.</p>
</div>
<div class="paragraph">
<p>To advertise an appender configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the JmDns library from <a href="http://jmdns.sourceforge.net" class="bare">http://jmdns.sourceforge.net</a> to the
application classpath</p>
</li>
<li>
<p>Set the 'advertiser' attribute of the configuration element to
'multicastdns'</p>
</li>
<li>
<p>Set the 'advertise' attribute on the appender element to 'true'</p>
</li>
<li>
<p>If advertising a FileAppender-based configuration, set the
'advertiseURI' attribute on the appender element to an appropriate URI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FileAppender-based configurations require an additional 'advertiseURI'
attribute to be specified on the appender. The 'advertiseURI' attribute
provides Chainsaw with information on how the file can be accessed. For
example, the file may be remotely accessible to Chainsaw via ssh/sftp by
specifying a Commons VFS (<a href="http://commons.apache.org/proper/commons-vfs/" class="bare">http://commons.apache.org/proper/commons-vfs/</a>)
sftp:// URI, an http:// URI may be used if the file is accessible
through a web server, or a file:// URI can be specified if accessing the
file from a locally-running instance of Chainsaw.</p>
</div>
<div class="paragraph">
<p>Here is an example advertisement-enabled appender configuration which
can be used by a locally-running Chainsaw to automatically tail the log
file (notice the file:// advertiseURI):</p>
</div>
<div class="paragraph">
<p><strong>Please note, you must add the JmDNS library mentioned above.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration advertiser="multicastdns"&gt;
  ...
  &lt;Appenders&gt;
    &lt;File name="File1" fileName="output.log" bufferedIO="false" advertiseURI="file://path/to/output.log" advertise="true"&gt;
    ...
    &lt;/File&gt;
  &lt;/Appenders&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ConfigurationSyntax"><a class="anchor" href="#ConfigurationSyntax"></a>Configuration Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of version 2.9, for security reasons, Log4j does not process DTD in
XML files. If you want to split the configuration in multiple files, use
<a href="#XInclude">XInclude</a> or <a href="#CompositeConfiguration">Composite
Configuration</a>.</p>
</div>
<div class="paragraph">
<p>As the previous examples have shown as well as those to follow, Log4j
allows you to easily redefine logging behavior without needing to modify
your application. It is possible to disable logging for certain parts of
the application, log only when specific criteria are met such as the
action being performed for a specific user, route output to Flume or a
log reporting system, etc. Being able to do this requires understanding
the syntax of the configuration files.</p>
</div>
<div class="paragraph">
<p>The configuration element in the XML file accepts several attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>advertiser</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(Optional) The Advertiser plugin name which will be used to
advertise individual FileAppender or SocketAppender configurations. The
only Advertiser plugin provided is "multicastdns".</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dest</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Either "err" for stderr, "out" for stdout, a file path, or a URL.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitorInterval</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The minimum amount of time, in seconds, that must
elapse before the file configuration is checked for changes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Identifies the location for the classloader to located the XML
Schema to use to validate the configuration. Only valid when strict is
set to true. If not set no schema validation will take place.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdownHook</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies whether or not Log4j should automatically
shutdown when the JVM shuts down. The shutdown hook is enabled by
default but may be disabled by setting this attribute to "disable"</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdownTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how many milliseconds appenders and
background tasks will get to shutdown when the JVM shuts down. Default
is zero which mean that each appender uses its default timeout, and
don&#8217;t wait for background tasks. Not all appenders will honor this, it
is a hint and not an absolute guarantee that the shutdown procedure will
not take longer. Setting this too low increase the risk of losing
outstanding log events not yet written to the final destination. See
<a href="../javadoc/log4j-core/org/apache/logging/log4j/core/LoggerContext.html$%7Besc.hash%7Dstop(long,%20java.util.concurrent.TimeUnit)">LoggerContext.stop(long,
java.util.concurrent.TimeUnit)</a>. (Not used if <code>shutdownHook</code> is set to
"disable".)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The level of internal Log4j events that should be logged to the console.
Valid values for this attribute are "off", "trace", "debug", "info", "warn",
"error", "fatal", and "all". Log4j will log details about initialization,
rollover and other internal actions to the status logger. Setting
<code>status="trace"</code> is one of the first tools available to you if you need
to troubleshoot log4j.</p>
</div>
<div class="paragraph">
<p>(Alternatively, setting system property <code>log4j2.debug</code> will also print
internal Log4j2 logging to the console, including internal logging that
took place before the configuration file was found.)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enables the use of the strict XML format. Not supported in JSON
configurations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>verbose</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enables diagnostic information while loading plugins.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="XML"><a class="anchor" href="#XML"></a>Configuration with XML</h3>
<div class="paragraph">
<p>Log4j can be configured using two XML flavors; concise and strict.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concise_syntax"><a class="anchor" href="#_concise_syntax"></a>Concise Syntax</h3>
<div class="paragraph">
<p>The concise format makes configuration very easy as the element names match
the components they represent however it cannot be validated with an XML
schema. For example, the ConsoleAppender is configured by declaring an
XML element named Console under its parent appenders element. However,
element and attribute names are not case sensitive. In addition,
attributes can either be specified as an XML attribute or as an XML
element that has no attributes and has a text value. So</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PatternLayout pattern="%m%n"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PatternLayout&gt;
  &lt;Pattern&gt;%m%n&lt;/Pattern&gt;
&lt;/PatternLayout&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>are equivalent.</p>
</div>
<div class="paragraph">
<p>The file below represents the structure of an XML configuration, but
note that the elements in italics below represent the concise element
names that would appear in their place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;;
&lt;Configuration&gt;
  &lt;Properties&gt;
    &lt;Property name="name1"&gt;value&lt;/property&gt;
    &lt;Property name="name2" value="value2"/&gt;
  &lt;/Properties&gt;
  &lt;filter  ... /&gt;
  &lt;Appenders&gt;
    &lt;appender ... &gt;
      &lt;filter  ... /&gt;
    &lt;/appender&gt;
    ...
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="name1"&gt;
      &lt;filter  ... /&gt;
    &lt;/Logger&gt;
    ...
    &lt;Root level="level"&gt;
      &lt;AppenderRef ref="name"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the many examples on this page for sample appender, filter and
logger declarations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_strict_xml"><a class="anchor" href="#_strict_xml"></a>Strict XML</h3>
<div class="paragraph">
<p>In addition to the concise XML format above, Log4j allows configurations
to be specified in a more "normal" XML manner that can be validated
using an XML Schema. This is accomplished by replacing the friendly
element names above with their object type as shown below. For example,
instead of the ConsoleAppender being configured using an element named
Console it is instead configured as an appender element with a type
attribute containing "Console".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
  &lt;Properties&gt;
    &lt;Property name="name1"&gt;value&lt;/property&gt;
    &lt;Property name="name2" value="value2"/&gt;
  &lt;/Properties&gt;
  &lt;Filter type="type" ... /&gt;
  &lt;Appenders&gt;
    &lt;Appender type="type" name="name"&gt;
      &lt;Filter type="type" ... /&gt;
    &lt;/Appender&gt;
    ...
  &lt;/Appenders&gt;
  &lt;Loggers&gt;
    &lt;Logger name="name1"&gt;
      &lt;Filter type="type" ... /&gt;
    &lt;/Logger&gt;
    ...
    &lt;Root level="level"&gt;
      &lt;AppenderRef ref="name"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is a sample configuration using the strict format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" strict="true" name="XMLConfigTest"
               packages="org.apache.logging.log4j.test"&gt;
  &lt;Properties&gt;
    &lt;Property name="filename"&gt;target/test.log&lt;/Property&gt;
  &lt;/Properties&gt;
  &lt;Filter type="ThresholdFilter" level="trace"/&gt;

  &lt;Appenders&gt;
    &lt;Appender type="Console" name="STDOUT"&gt;
      &lt;Layout type="PatternLayout" pattern="%m MDC%X%n"/&gt;
      &lt;Filters&gt;
        &lt;Filter type="MarkerFilter" marker="FLOW" onMatch="DENY" onMismatch="NEUTRAL"/&gt;
        &lt;Filter type="MarkerFilter" marker="EXCEPTION" onMatch="DENY" onMismatch="ACCEPT"/&gt;
      &lt;/Filters&gt;
    &lt;/Appender&gt;
    &lt;Appender type="Console" name="FLOW"&gt;
      &lt;Layout type="PatternLayout" pattern="%C{1}.%M %m %ex%n"/&gt;&lt;!-- class and line number --&gt;
      &lt;Filters&gt;
        &lt;Filter type="MarkerFilter" marker="FLOW" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;
        &lt;Filter type="MarkerFilter" marker="EXCEPTION" onMatch="ACCEPT" onMismatch="DENY"/&gt;
      &lt;/Filters&gt;
    &lt;/Appender&gt;
    &lt;Appender type="File" name="File" fileName="${filename}"&gt;
      &lt;Layout type="PatternLayout"&gt;
        &lt;Pattern&gt;%d %p %C{1.} [%t] %m%n&lt;/Pattern&gt;
      &lt;/Layout&gt;
    &lt;/Appender&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name="org.apache.logging.log4j.test1" level="debug" additivity="false"&gt;
      &lt;Filter type="ThreadContextMapFilter"&gt;
        &lt;KeyValuePair key="test" value="123"/&gt;
      &lt;/Filter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Logger&gt;

    &lt;Logger name="org.apache.logging.log4j.test2" level="debug" additivity="false"&gt;
      &lt;AppenderRef ref="File"/&gt;
    &lt;/Logger&gt;

    &lt;Root level="trace"&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JSON"><a class="anchor" href="#JSON"></a>Configuration with JSON</h3>
<div class="paragraph">
<p>In addition to XML, Log4j can be configured using JSON. The JSON format
is very similar to the concise XML format. Each key represents the name
of a plugin and the key/value pairs associated with it are its
attributes. Where a key contains more than a simple value it itself will
be a subordinate plugin. In the example below, ThresholdFilter, Console,
and PatternLayout are all plugins while the Console plugin will be
assigned a value of STDOUT for its name attribute and the
ThresholdFilter will be assigned a level of debug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{ "configuration": { "status": "error", "name": "RoutingTest",
                     "packages": "org.apache.logging.log4j.test",
      "properties": {
        "property": { "name": "filename",
                      "value" : "target/rolling1/rollingtest-$${sd:type}.log" }
      },
    "ThresholdFilter": { "level": "debug" },
    "appenders": {
      "Console": { "name": "STDOUT",
        "PatternLayout": { "pattern": "%m%n" },
        "ThresholdFilter": { "level": "debug" }
      },
      "Routing": { "name": "Routing",
        "Routes": { "pattern": "$${sd:type}",
          "Route": [
            {
              "RollingFile": {
                "name": "Rolling-${sd:type}", "fileName": "${filename}",
                "filePattern": "target/rolling1/test1-${sd:type}.%i.log.gz",
                "PatternLayout": {"pattern": "%d %p %c{1.} [%t] %m%n"},
                "SizeBasedTriggeringPolicy": { "size": "500" }
              }
            },
            { "AppenderRef": "STDOUT", "key": "Audit"}
          ]
        }
      }
    },
    "loggers": {
      "logger": { "name": "EventLogger", "level": "info", "additivity": "false",
                  "AppenderRef": { "ref": "Routing" }},
      "root": { "level": "error", "AppenderRef": { "ref": "STDOUT" }}
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the RoutingAppender the Route element has been declared as
an array. This is valid because each array element will be a Route
component. This won&#8217;t work for elements such as appenders and filters,
where each element has a different name in the concise format. Appenders
and filters can be defined as array elements if each appender or filter
declares an attribute named "type" that contains the type of the
appender. The following example illustrates this as well as how to
declare multiple loggers as an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{ "configuration": { "status": "debug", "name": "RoutingTest",
                      "packages": "org.apache.logging.log4j.test",
      "properties": {
        "property": { "name": "filename",
                      "value" : "target/rolling1/rollingtest-$${sd:type}.log" }
      },
    "ThresholdFilter": { "level": "debug" },
    "appenders": {
      "appender": [
         { "type": "Console", "name": "STDOUT", "PatternLayout": { "pattern": "%m%n" }, "ThresholdFilter": { "level": "debug" }},
         { "type": "Routing",  "name": "Routing",
          "Routes": { "pattern": "$${sd:type}",
            "Route": [
              {
                "RollingFile": {
                  "name": "Rolling-${sd:type}", "fileName": "${filename}",
                  "filePattern": "target/rolling1/test1-${sd:type}.%i.log.gz",
                  "PatternLayout": {"pattern": "%d %p %c{1.} [%t] %m%n"},
                  "SizeBasedTriggeringPolicy": { "size": "500" }
                }
              },
              { "AppenderRef": "STDOUT", "key": "Audit"}
            ]
          }
        }
      ]
    },
    "loggers": {
      "logger": [
        { "name": "EventLogger", "level": "info", "additivity": "false",
          "AppenderRef": { "ref": "Routing" }},
        { "name": "com.foo.bar", "level": "error", "additivity": "false",
          "AppenderRef": { "ref": "STDOUT" }}
      ],
      "root": { "level": "error", "AppenderRef": { "ref": "STDOUT" }}
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional <a href="../runtime-dependencies.html" class="xref page">runtime dependencies</a> are
required for using JSON configuration files.</p>
</div>
</div>
<div class="sect2">
<h3 id="YAML"><a class="anchor" href="#YAML"></a>Configuration with YAML</h3>
<div class="paragraph">
<p>Log4j also supports using YAML for configuration files. The structure
follows the same pattern as both the XML and YAML configuration formats.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Configuration:
  status: warn
  name: YAMLConfigTest
  properties:
    property:
      name: filename
      value: target/test-yaml.log
  thresholdFilter:
    level: debug
  appenders:
    Console:
      name: STDOUT
      target: SYSTEM_OUT
      PatternLayout:
        Pattern: "%m%n"
    File:
      name: File
      fileName: ${filename}
      PatternLayout:
        Pattern: "%d %p %C{1.} [%t] %m%n"
      Filters:
        ThresholdFilter:
          level: error

  Loggers:
    logger:
      -
        name: org.apache.logging.log4j.test1
        level: debug
        additivity: false
        ThreadContextMapFilter:
          KeyValuePair:
            key: test
            value: 123
        AppenderRef:
          ref: STDOUT
      -
        name: org.apache.logging.log4j.test2
        level: debug
        additivity: false
        AppenderRef:
          ref: File
    Root:
      level: error
      AppenderRef:
        ref: STDOUT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional <a href="../runtime-dependencies.html" class="xref page">runtime dependencies</a> are
required for using YAML configuration files.</p>
</div>
</div>
<div class="sect2">
<h3 id="Properties"><a class="anchor" href="#Properties"></a>Configuration with Properties</h3>
<div class="paragraph">
<p>As of version 2.4, Log4j now supports configuration via properties
files. Note that the property syntax is NOT the same as the syntax used
in Log4j 1. Like the XML and JSON configurations, properties
configurations define the configuration in terms of plugins and
attributes to the plugins.</p>
</div>
<div class="paragraph">
<p>Prior to version 2.6, the properties configuration requires that you
list the identifiers of the appenders, filters and loggers, in a comma
separated list in properties with those names. Each of those components
will then be expected to be defined in sets of properties that begin
with <em>component.&lt;.identifier&gt;.</em>. The identifier does not have to match
the name of the component being defined but must uniquely identify all
the attributes and subcomponents that are part of the component. If the
list of identifiers is not present the identifier must not contain a '.'.
Each individual component MUST have a "type" attribute specified that
identifies the component&#8217;s Plugin type.</p>
</div>
<div class="paragraph">
<p>As of version 2.6, this list of identifiers is no longer required as
names are inferred upon first usage, however if you wish to use more
complex identifies you must still use the list. If the list is present
it will be used.</p>
</div>
<div class="paragraph">
<p>Unlike the base components, when creating subcomponents you cannot
specify an element containing a list of identifiers. Instead, you must
define the wrapper element with its type as is shown in the policies
definition in the rolling file appender below. You then define each of
the subcomponents below that wrapper element, as the
TimeBasedTriggeringPolicy and SizeBasedTriggeringPolicy are defined
below.</p>
</div>
<div class="paragraph">
<p>As of version 2.17.2, <code>rootLogger</code> and <code>logger.<em>key</em></code> properties can be specified to set the
level and zero or more appender refs to create for that logger. The level and appender refs are
separated by comma <code>,</code> characters with optional whitespace surrounding the comma. The
following example demonstrates how the shorthand is expanded when reading properties configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">appender.stdout.type = Console
# ... other appender properties
appender.file.type = File
# ... other appender properties
logger.app = INFO, stdout, file
logger.app.name = com.example.app

# is equivalent to:
# appender.stdout.type = Console
# appender.stdout.name = stdout
# ...
appender.file.type = File
appender.file.name = file
# ...
logger.app.name = com.example.app
logger.app.level = INFO
logger.app.appenderRef.$1.ref = stdout
logger.app.appenderRef.$2.ref = file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties configuration files support the advertiser, monitorInterval,
name, packages, shutdownHook, shutdownTimeout, status, verbose, and dest
attributes. See <a href="#ConfigurationSyntax">Configuration Syntax</a> for the
definitions of these attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">status = error
dest = err
name = PropertiesConfig

property.filename = target/rolling/rollingtest.log

filter.threshold.type = ThresholdFilter
filter.threshold.level = debug

appender.console.type = Console
appender.console.name = STDOUT
appender.console.layout.type = PatternLayout
appender.console.layout.pattern = %m%n
appender.console.filter.threshold.type = ThresholdFilter
appender.console.filter.threshold.level = error

appender.rolling.type = RollingFile
appender.rolling.name = RollingFile
appender.rolling.fileName = ${filename}
appender.rolling.filePattern = target/rolling2/test1-%d{MM-dd-yy-HH-mm-ss}-%i.log.gz
appender.rolling.layout.type = PatternLayout
appender.rolling.layout.pattern = %d %p %C{1.} [%t] %m%n
appender.rolling.policies.type = Policies
appender.rolling.policies.time.type = TimeBasedTriggeringPolicy
appender.rolling.policies.time.interval = 2
appender.rolling.policies.time.modulate = true
appender.rolling.policies.size.type = SizeBasedTriggeringPolicy
appender.rolling.policies.size.size=100MB
appender.rolling.strategy.type = DefaultRolloverStrategy
appender.rolling.strategy.max = 5

logger.rolling.name = com.example.my.app
logger.rolling.level = debug
logger.rolling.additivity = false
logger.rolling.appenderRef.rolling.ref = RollingFile

rootLogger.level = info
rootLogger.appenderRef.stdout.ref = STDOUT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Loggers"><a class="anchor" href="#Loggers"></a>Configuring Loggers</h3>
<div class="paragraph">
<p>An understanding of how loggers work in Log4j is critical before trying
to configure them. Please reference the Log4j
<a href="architecture.html" class="xref page">architecture</a> if more information is required.
Trying to configure Log4j without understanding those concepts will lead
to frustration.</p>
</div>
<div class="paragraph">
<p>A LoggerConfig is configured using the <code>logger</code> element. The <code>logger</code>
element must have a name attribute specified, will usually have a level
attribute specified and may also have an additivity attribute specified.
The level may be configured with one of TRACE, DEBUG, INFO, WARN, ERROR,
ALL or OFF. If no level is specified it will default to ERROR. The
additivity attribute may be assigned a value of true or false. If the
attribute is omitted the default value of true will be used.</p>
</div>
<div class="paragraph">
<p>Capturing location information (the class name, file name, method name, and line number of the caller)
can be slow. Log4j tries to optimize this by reducing the size of the stack that must be traversed
to find the caller of the logging method. It does this by determining if any component that might
be accessed requires location information. This can cause performance issues if a logger is configured
at a level like trace or debug with the expectation that most logs will be filtered on an Appender
reference or Appender as Log4j will calculate the location information even though the log event
is going to be discarded. To disable this behavior the <code>includeLocation</code> attribute
can be set to false on the LoggerConfig. This will cause Log4j to defer calculating the location
information until absolutely necessary.</p>
</div>
<div class="paragraph">
<p>A LoggerConfig (including the root LoggerConfig) can be configured with
properties that will be added to the properties copied from the
ThreadContextMap. These properties can be referenced from Appenders,
Filters, Layouts, etc just as if they were part of the ThreadContext
Map. The properties can contain variables that will be resolved either
when the configuration is parsed or dynamically when each event is
logged. See <a href="#PropertySubstitution">Property Substitution</a> for more
information on using variables.</p>
</div>
<div class="paragraph">
<p>The LoggerConfig may also be configured with one or more AppenderRef
elements. Each appender referenced will become associated with the
specified LoggerConfig. If multiple appenders are configured on the
LoggerConfig each of them be called when processing logging events.</p>
</div>
<div class="paragraph">
<p><strong><em>Every configuration must have a root logger</em></strong>. If one is not
configured the default root LoggerConfig, which has a level of ERROR and
has a Console appender attached, will be used. The main differences
between the root logger and other loggers are</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The root logger does not have a name attribute.</p>
</li>
<li>
<p>The root logger does not support the additivity attribute since it
has no parent.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Appenders"><a class="anchor" href="#Appenders"></a>Configuring Appenders</h3>
<div class="paragraph">
<p>An appender is configured either using the specific appender plugin&#8217;s
name or with an appender element and the type attribute containing the
appender plugin&#8217;s name. In addition each appender must have a name
attribute specified with a value that is unique within the set of
appenders. The name will be used by loggers to reference the appender as
described in the previous section.</p>
</div>
<div class="paragraph">
<p>Most appenders also support a layout to be configured (which again may
be specified either using the specific Layout plugin&#8217;s name as the
element or with "layout" as the element name along with a type attribute
that contains the layout plugin&#8217;s name. The various appenders will
contain other attributes or elements that are required for them to
function properly.</p>
</div>
</div>
<div class="sect2">
<h3 id="Filters"><a class="anchor" href="#Filters"></a>Configuring Filters</h3>
<div class="paragraph">
<p>Log4j allows a filter to be specified in any of 4 places:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At the same level as the appenders, loggers and properties elements.
These filters can accept or reject events before they have been passed
to a LoggerConfig.</p>
</li>
<li>
<p>In a logger element. These filters can accept or reject events for
specific loggers.</p>
</li>
<li>
<p>In an appender element. These filters can prevent or cause events to
be processed by the appender.</p>
</li>
<li>
<p>In an appender reference element. These filters are used to
determine if a Logger should route the event to an appender.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Although only a single <code>filter</code> element can be configured, that element
may be the <code>filters</code> element which represents the CompositeFilter. The
<code>filters</code> element allows any number of <code>filter</code> elements to be
configured within it. The following example shows how multiple filters
can be configured on the ConsoleAppender.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" name="XMLConfigTest" packages="org.apache.logging.log4j.test"&gt;
  &lt;Properties&gt;
    &lt;Property name="filename"&gt;target/test.log&lt;/Property&gt;
  &lt;/Properties&gt;
  &lt;ThresholdFilter level="trace"/&gt;

  &lt;Appenders&gt;
    &lt;Console name="STDOUT"&gt;
      &lt;PatternLayout pattern="%m MDC%X%n"/&gt;
    &lt;/Console&gt;
    &lt;Console name="FLOW"&gt;
      &lt;!-- this pattern outputs class name and line number --&gt;
      &lt;PatternLayout pattern="%C{1}.%M %m %ex%n"/&gt;
      &lt;filters&gt;
        &lt;MarkerFilter marker="FLOW" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;
        &lt;MarkerFilter marker="EXCEPTION" onMatch="ACCEPT" onMismatch="DENY"/&gt;
      &lt;/filters&gt;
    &lt;/Console&gt;
    &lt;File name="File" fileName="${filename}"&gt;
      &lt;PatternLayout&gt;
        &lt;pattern&gt;%d %p %C{1.} [%t] %m%n&lt;/pattern&gt;
      &lt;/PatternLayout&gt;
    &lt;/File&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name="org.apache.logging.log4j.test1" level="debug" additivity="false"&gt;
      &lt;ThreadContextMapFilter&gt;
        &lt;KeyValuePair key="test" value="123"/&gt;
      &lt;/ThreadContextMapFilter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Logger&gt;

    &lt;Logger name="org.apache.logging.log4j.test2" level="debug" additivity="false"&gt;
      &lt;Property name="user"&gt;${sys:user.name}&lt;/Property&gt;
      &lt;AppenderRef ref="File"&gt;
        &lt;ThreadContextMapFilter&gt;
          &lt;KeyValuePair key="test" value="123"/&gt;
        &lt;/ThreadContextMapFilter&gt;
      &lt;/AppenderRef&gt;
      &lt;AppenderRef ref="STDOUT" level="error"/&gt;
    &lt;/Logger&gt;

    &lt;Root level="trace"&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="PropertySubstitution"><a class="anchor" href="#PropertySubstitution"></a>Property Substitution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j 2 supports the ability to specify tokens in the configuration as
references to properties defined elsewhere. Some of these properties
will be resolved when the configuration file is interpreted while others
may be passed to components where they will be evaluated at runtime. To
accomplish this, Log4j uses variations of
<a href="https://commons.apache.org/proper/commons-lang/">Apache Commons Lang</a>'s
<a href="../javadoc/log4j-core/org/apache/logging/log4j/core/lookup/StrSubstitutor.html"><code>StrSubstitutor</code></a>
and
<a href="../javadoc/log4j-core/org/apache/logging/log4j/core/lookup/StrLookup.html"><code>StrLookup</code></a>
classes. In a manner similar to Ant or Maven, this allows variables
declared as <code>${name}</code> to be resolved using properties declared in the
configuration itself. For example, the following example shows the
filename for the rolling file appender being declared as a property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" name="RoutingTest" packages="org.apache.logging.log4j.test"&gt;
  &lt;Properties&gt;
    &lt;Property name="filename"&gt;target/rolling1/rollingtest-$${sd:type}.log&lt;/Property&gt;
  &lt;/Properties&gt;
  &lt;ThresholdFilter level="debug"/&gt;

  &lt;Appenders&gt;
    &lt;Console name="STDOUT"&gt;
      &lt;PatternLayout pattern="%m%n"/&gt;
      &lt;ThresholdFilter level="debug"/&gt;
    &lt;/Console&gt;
    &lt;Routing name="Routing"&gt;
      &lt;Routes pattern="$${sd:type}"&gt;
        &lt;Route&gt;
          &lt;RollingFile name="Rolling-${sd:type}" fileName="${filename}"
                       filePattern="target/rolling1/test1-${sd:type}.%i.log.gz"&gt;
            &lt;PatternLayout&gt;
              &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
            &lt;/PatternLayout&gt;
            &lt;SizeBasedTriggeringPolicy size="500" /&gt;
          &lt;/RollingFile&gt;
        &lt;/Route&gt;
        &lt;Route ref="STDOUT" key="Audit"/&gt;
      &lt;/Routes&gt;
    &lt;/Routing&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name="EventLogger" level="info" additivity="false"&gt;
      &lt;AppenderRef ref="Routing"/&gt;
    &lt;/Logger&gt;

    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this is useful, there are many more places properties can
originate from. To accommodate this, Log4j also supports the syntax
<code>${prefix:name}</code> where the prefix identifies tells Log4j that variable
name should be evaluated in a specific context. See the
<a href="lookups.html" class="xref page">Lookups</a> manual page for more details. The contexts
that are built in to Log4j are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context</p>
<p class="tableblock">              &lt;tr&gt;
                &lt;td&gt;base64&lt;/td&gt;
                &lt;td&gt;
                  Base64 encoded data. The format is &lt;code&gt;${base64:Base64_encoded_data}&lt;/code&gt;.
                  For example:
                  &lt;code&gt;${base64:SGVsbG8gV29ybGQhCg==}&lt;/code&gt; yields &lt;code&gt;Hello World!&lt;/code&gt;.
                &lt;/td&gt;
              &lt;/tr&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base64 encoded data. The format is <code>${base64:Base64_encoded_data}</code>.
For example: <code>${base64:SGVsbG8gV29ybGQhCg==}</code> yields <code>Hello World!</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bundle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource bundle. The format is <code>${bundle:BundleName:BundleKey}</code>.
The bundle name follows package naming conventions, for example:
<code>${bundle:com.domain.Messages:MyKey}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ctx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread Context Map (MDC)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts the current date and/or time using the specified format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns attributes from the Docker container the application is running in. The format is ${docker:some.attribute}. See <a href="../log4j-docker.html" class="xref page">Docker documentation</a> for requirements and a list of available attributes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System environment variables. The formats are <code>${env:ENV_NAME}</code> and <code>${env:ENV_NAME:-default_value}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves values from fields within the log event. The format is ${event:some.field}. See the Lookups manual page for a list of available fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves information about the Java environment the application is running in. The format is ${java:some.property}. See the Lookups manual page for a list of available properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value set in the default JNDI Context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jvmrunargs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A JVM input argument accessed through JMX, but not a main argument; see
<a href="https://docs.oracle.com/javase/6/docs/api/java/lang/management/RuntimeMXBean.html#getInputArguments--">RuntimeMXBean.getInputArguments()</a>.
Not available on Android.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k8s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns attributes from the Kubernetes environment the application is running in. The format is ${k8s:some.attribute}. See the Lookups manual page for a list of available attributes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4j configuration properties. The expressions
<code>${log4j:configLocation}</code> and <code>${log4j:configParentLocation}</code>
respectively provide the absolute path to the log4j configuration file
and its parent folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lower</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts the passed in argument to lower case (usually used with nested lookups). The format is ${lower:argument}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>main</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value set with
../log4j-core/apidocs/org/apache/logging/log4j/core/lookup/MapLookup.html#setMainArguments-java.lang.String:A-[MapLookup.setMainArguments(String[])]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value from a MapMessage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows use of markers in configurations. The formats are ${marker:} and ${marker:some.name}. See the Lookups manual page for further details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value from a StructuredDataMessage. The key "id" will return the
name of the StructuredDataId without the enterprise number. The key
"type" will return the message type. Other keys will retrieve individual
elements from the Map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns values of Spring properties from the Spring configuration. The format is ${spring:some.property}. See the Lookups manual page for requirements and details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System properties. The formats are <code>${sys:some.property}</code> and
<code>${sys:some.property:-default_value}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts the passed in argument to upper case (usually used with nested lookups). The format is ${upper:argument}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns values of variables associated with the Servlet Context. The format is ${spring:some.key}. See the Lookups manual page for a list of available keys.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="DefaultProperties"><a class="anchor" href="#DefaultProperties"></a>Default Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A default property map can be declared in the configuration file by placing a Properties
element directly after the Configuration element and before any Loggers, Filters,
Appenders, etc. are declared. If the value cannot be located in the specified lookup the
value in the default property map will be used. The default map is pre-populated with a value
for "hostName" that is the current system&#8217;s host name or IP address and
the "contextName" with is the value of the current logging context. See many places
a Properties element is used in this section for examples.</p>
</div>
<div class="paragraph">
<p>Default properties may also be specified in the Lookup by using the syntax <code>${lookupName:key:-defaultValue}</code>.
In some cases the key might contain a leading '-'. When this is the case an escape character must be
included, such as <code>`${main:\--file:-app.properties}</code>. This would use the
<code>MainMapLookup</code> for a key named <code>--file</code>. If the key is not found then
&lt;code&gt;app.properties&lt;/code&gt; would be used as the default value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EnablingMessagePatternLookups"><a class="anchor" href="#EnablingMessagePatternLookups"></a>Enabling Message Pattern Lookups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A message is processed (by default) without using lookups, for example if you defined
<code>&lt;Property name="foo.bar"&gt;FOO_BAR&lt;/Property&gt;</code>, then <code>logger.info("${foo.bar}")</code> will output <code>${foo.bar}</code> instead of <code>FOO_BAR</code>.
You could enable message pattern lookups by defining the message pattern using <code>%m{lookups}</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="RuntimeLookup"><a class="anchor" href="#RuntimeLookup"></a>Lookup Variables with Multiple Leading '$' Characters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An interesting feature of StrLookup processing is that when a variable
reference is declared with multiple leading '$' characters each time the
variable is resolved the leading '$' is simply removed. In the previous
example the "Routes" element is capable of resolving the variable at
runtime. To allow this the prefix value is specified as a variable with
two leading '$' characters. When the configuration file is first
processed the first '$' character is simply removed. Thus, when the
Routes element is evaluated at runtime it is the variable declaration
"$\{sd:type}" which causes the event to be inspected for a
StructuredDataMessage and if one is present the value of its type
attribute to be used as the routing key. Not all elements support
resolving variables at runtime. Components that do will specifically
call that out in their documentation.</p>
</div>
<div class="paragraph">
<p>If no value is found for the key in the Lookup associated with the
prefix then the value associated with the key in the properties
declaration in the configuration file will be used. If no value is found
the variable declaration will be returned as the value. Default values
may be declared in the configuration by doing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration&gt;
  &lt;Properties&gt;
    &lt;Property name="type"&gt;Audit&lt;/property&gt;
  &lt;/Properties&gt;
  ...
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>As a footnote, it is worth pointing out that the variables in the
RollingFile appender declaration will also not be evaluated when the
configuration is processed. This is simply because the resolution of the
whole RollingFile element is deferred until a match occurs. See
<a href="appenders.html#RoutingAppender" class="xref page">RoutingAppender</a> for more
information.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Scripts"><a class="anchor" href="#Scripts"></a>Scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j provides support for
<a href="https://docs.oracle.com/javase/6/docs/technotes/guides/scripting/">JSR
223</a> scripting languages to be used in some of its components. Any
language that provides support for the JSR 223 scripting engine may be
used. A list of the languages and bindings for them can be found at the
<a href="https://java.net/projects/scripting/sources/svn/show/trunk/engines">Scripting
Engine</a> web site. However, some of the languages listed there, such as
JavaScript, Groovy and Beanshell, directly support the JSR 223 scripting
framework and only require that the jars for that language be installed.</p>
</div>
<div class="paragraph">
<p>As of Log4j 2.17.2 the languages to be supported must be specified as a comma separated list in the
<code>log4j2.Script.enableLanguages</code> system property.</p>
</div>
<div class="paragraph">
<p>The components that support using scripts do so by allowing a <code>&lt;script&gt;</code>,
<code>&lt;scriptFile&gt;</code>, or <code>&lt;scriptRef&gt;</code> element to be configured on them. The
script element contains a name for the script, the language of the
script, and the script text. The scriptFile element contains the name of
the script, its location, its language, its charset, and whether the
file should be watched for changes. The scriptRef element contains the
name of the script that is defined in the <code>&lt;scripts&gt;</code> configuration
element. The name of the script is used to store the script, along with
its ScriptEngine, so it can quickly be located each time the script
needs to be run. While the name is not required, providing it will help
in debugging problems when the script is running. The language must be
provided on the script element and must specify one of the language
names that appear in the Configuration status log as described in the
next section. If the language is not specified on the scriptFile element
the language will be determined by the file extension of the script
path. If file monitoring is requested it will only be enabled if a
non-zero monitorInterval is specified on the configuration element. That
interval will be used to check for changes in the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" name="RoutingTest"&gt;
  &lt;Scripts&gt;
    &lt;Script name="selector" language="javascript"&gt;&lt;![CDATA[
            var result;
            if (logEvent.getLoggerName().equals("JavascriptNoLocation")) {
                result = "NoLocation";
            } else if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
                result = "Flow";
            }
            result;
            ]]&gt;&lt;/Script&gt;
    &lt;ScriptFile name="groovy.filter" path="scripts/filter.groovy"/&gt;
  &lt;/Scripts&gt;

  &lt;Appenders&gt;
    &lt;Console name="STDOUT"&gt;
      &lt;ScriptPatternSelector defaultPattern="%d %p %m%n"&gt;
        &lt;ScriptRef ref="selector"/&gt;
          &lt;PatternMatch key="NoLocation" pattern="[%-5level] %c{1.} %msg%n"/&gt;
          &lt;PatternMatch key="Flow" pattern="[%-5level] %c{1.} ====== %C{1.}.%M:%L %msg ======%n"/&gt;
      &lt;/ScriptPatternSelector&gt;
      &lt;PatternLayout pattern="%m%n"/&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name="EventLogger" level="info" additivity="false"&gt;
        &lt;ScriptFilter onMatch="ACCEPT" onMisMatch="DENY"&gt;
          &lt;Script name="GroovyFilter" language="groovy"&gt;&lt;![CDATA[
            if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
                return true;
            } else if (logEvent.getContextMap().containsKey("UserId")) {
                return true;
            }
            return false;
            ]]&gt;
          &lt;/Script&gt;
        &lt;/ScriptFilter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Logger&gt;

    &lt;Root level="error"&gt;
      &lt;ScriptFilter onMatch="ACCEPT" onMisMatch="DENY"&gt;
        &lt;ScriptRef ref="groovy.filter"/&gt;
      &lt;/ScriptFilter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the status attribute on the Configuration element is set to DEBUG the
list of script engines currently installed and their attributes will be
listed. Although some engines may say they are not thread safe, Log4j
takes steps to insure that the scripts will run in a thread-safe manner
if the engine advertises that it is not thread safe.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2015-09-27 16:13:22,925 main DEBUG Installed script engines
2015-09-27 16:13:22,963 main DEBUG AppleScriptEngine Version: 1.1, Language: AppleScript, Threading: Not Thread Safe,
            Compile: false, Names: {AppleScriptEngine, AppleScript, OSA}
2015-09-27 16:13:22,983 main DEBUG Groovy Scripting Engine Version: 2.0, Language: Groovy, Threading: MULTITHREADED,
            Compile: true, Names: {groovy, Groovy}
2015-09-27 16:13:23,030 main DEBUG BeanShell Engine Version: 1.0, Language: BeanShell, Threading: MULTITHREADED,
            Compile: true, Names: {beanshell, bsh, java}
2015-09-27 16:13:23,039 main DEBUG Mozilla Rhino Version: 1.7 release 3 PRERELEASE, Language: ECMAScript, Threading: MULTITHREADED,
            Compile: true, Names: {js, rhino, JavaScript, javascript, ECMAScript, ecmascript}</pre>
</div>
</div>
<div class="paragraph">
<p>When the scripts are executed they will be provided with a set of
variables that should allow them to accomplish whatever task they are
expected to perform. See the documentation for the individual components
for the list of variables that are available to the script.</p>
</div>
<div class="paragraph">
<p>The components that support scripting expect a return value to be passed
back to the calling Java code. This is not a problem for several of the
scripting languages, but Javascript does not allow a return statement
unless it is within a function. However, Javascript will return the
value of the last statement executed in the script. As a consequence,
code such as that shown below will result in the desired behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var result;
if (logEvent.getLoggerName().equals("JavascriptNoLocation")) {
    result = "NoLocation";
} else if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
    result = "Flow";
}
result;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_a_special_note_on_beanshell"><a class="anchor" href="#_a_special_note_on_beanshell"></a>A special note on Beanshell</h3>
<div class="paragraph">
<p>JSR 223 scripting engines are supposed to identify that they support the
Compilable interface if they support compiling their scripts. Beanshell
does this. However, whenever the compile method is called it throws an
Error (not an Exception). Log4j catches this but will log the warning
shown below for each Beanshell script when it tries to compile them. All
Beanshell scripts will then be interpreted on each execution.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2015-09-27 16:13:23,095 main DEBUG Script BeanShellSelector is compilable
2015-09-27 16:13:23,096 main WARN Error compiling script java.lang.Error: unimplemented
            at bsh.engine.BshScriptEngine.compile(BshScriptEngine.java:175)
            at bsh.engine.BshScriptEngine.compile(BshScriptEngine.java:154)
            at org.apache.logging.log4j.core.script.ScriptManager$MainScriptRunner.&lt;init&gt;(ScriptManager.java:125)
            at org.apache.logging.log4j.core.script.ScriptManager.addScript(ScriptManager.java:94)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="XInclude"><a class="anchor" href="#XInclude"></a>XInclude</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XML configuration files can include other files with
<a href="http://www.xml.com/lpt/a/1009">XInclude</a>. Here is an example log4j2.xml
file that includes two other files:</p>
</div>
<div class="listingblock">
<div class="title">log4j2.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration xmlns:xi="http://www.w3.org/2001/XInclude"
               status="warn" name="XIncludeDemo"&gt;
  &lt;properties&gt;
    &lt;property name="filename"&gt;xinclude-demo.log&lt;/property&gt;
  &lt;/properties&gt;
  &lt;ThresholdFilter level="debug"/&gt;
  &lt;xi:include href="log4j-xinclude-appenders.xml" /&gt;
  &lt;xi:include href="log4j-xinclude-loggers.xml" /&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">log4j-xinclude-appenders.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;appenders&gt;
  &lt;Console name="STDOUT"&gt;
    &lt;PatternLayout pattern="%m%n" /&gt;
  &lt;/Console&gt;
  &lt;File name="File" fileName="${filename}" bufferedIO="true" immediateFlush="true"&gt;
    &lt;PatternLayout&gt;
      &lt;pattern&gt;%d %p %C{1.} [%t] %m%n&lt;/pattern&gt;
    &lt;/PatternLayout&gt;
  &lt;/File&gt;
&lt;/appenders&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">log4j-xinclude-loggers.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;loggers&gt;
  &lt;logger name="org.apache.logging.log4j.test1" level="debug" additivity="false"&gt;
    &lt;ThreadContextMapFilter&gt;
      &lt;KeyValuePair key="test" value="123" /&gt;
    &lt;/ThreadContextMapFilter&gt;
    &lt;AppenderRef ref="STDOUT" /&gt;
  &lt;/logger&gt;

  &lt;logger name="org.apache.logging.log4j.test2" level="debug" additivity="false"&gt;
    &lt;AppenderRef ref="File" /&gt;
  &lt;/logger&gt;

  &lt;root level="error"&gt;
    &lt;AppenderRef ref="STDOUT" /&gt;
  &lt;/root&gt;
&lt;/loggers&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CompositeConfiguration"><a class="anchor" href="#CompositeConfiguration"></a>Composite Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Log4j allows multiple configuration files to be used by specifying them
as a list of comma separated file paths on log4j2.configurationFile or,
when using URLs, by adding secondary configuration locations as query
parameters named "override". The merge logic can be controlled by specifying
a class that implements the MergeStrategy interface on the log4j.mergeStrategy
property. The default merge strategy will merge the files using the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The global configuration attributes are aggregated with those in
later configurations replacing those in previous configurations, with
the exception that the highest status level and the lowest
monitorInterval greater than 0 will be used.</p>
</li>
<li>
<p>Properties from all configurations are aggregated. Duplicate
properties replace those in previous configurations.</p>
</li>
<li>
<p>Filters are aggregated under a CompositeFilter if more than one
Filter is defined. Since Filters are not named duplicates may be
present.</p>
</li>
<li>
<p>Scripts and ScriptFile references are aggregated. Duplicate
definitions replace those in previous configurations.</p>
</li>
<li>
<p>Appenders are aggregated. Appenders with the same name are replaced
by those in later configurations, including all of the Appender&#8217;s
subcomponents.</p>
</li>
<li>
<p>Loggers are all aggregated. Logger attributes are individually
merged with duplicates being replaced by those in later configurations.
Appender references on a Logger are aggregated with duplicates being
replaced by those in later configurations. Filters on a Logger are
aggregated under a CompositeFilter if more than one Filter is defined.
Since Filters are not named duplicates may be present. Filters under
Appender references included or discarded depending on whether their
parent Appender reference is kept or discarded.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="StatusMessages"><a class="anchor" href="#StatusMessages"></a>Status Messages</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Troubleshooting tip for the impatient:</strong></p>
</div>
<div class="paragraph">
<p>From log4j-2.9 onward, log4j2 will print all internal logging to the
console if system property <code>log4j2.debug</code> is either defined empty or its value
equals to <code>true</code> (ignoring case).</p>
</div>
<div class="paragraph">
<p>Prior to log4j-2.9, there are two places where internal logging can be
controlled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before a configuration is found, status logger level can be controlled
with system property
<code>org.apache.logging.log4j.simplelog.StatusLogger.level</code>.</p>
</li>
<li>
<p>After a configuration is found, status logger level can be controlled
in the configuration file with the "status" attribute, for example:
<code>&lt;Configuration status="trace"&gt;</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Just as it is desirable to be able to diagnose problems in applications,
it is frequently necessary to be able to diagnose problems in the
logging configuration or in the configured components. Since logging has
not been configured, "normal" logging cannot be used during
initialization. In addition, normal logging within appenders could
create infinite recursion which Log4j will detect and cause the
recursive events to be ignored. To accomodate this need, the Log4j 2 API
includes a
<a href="../javadoc/log4j-api/org/apache/logging/log4j/status/StatusLogger.html"><code>StatusLogger</code></a>.
Components declare an instance of the StatusLogger similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected final static Logger logger = StatusLogger.getLogger();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since StatusLogger implements the Log4j 2 API&#8217;s Logger interface, all
the normal Logger methods may be used.</p>
</div>
<div class="paragraph">
<p>When configuring Log4j it is sometimes necessary to view the generated
status events. This can be accomplished by adding the status attribute
to the configuration element or a default value can be provided by
setting the "Log4jDefaultStatusLevel" system property. Valid values of
the status attribute are "trace", "debug", "info", "warn", "error" and
"fatal". The following configuration has the status attribute set to
debug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" name="RoutingTest"&gt;
  &lt;Properties&gt;
    &lt;Property name="filename"&gt;target/rolling1/rollingtest-$${sd:type}.log&lt;/Property&gt;
  &lt;/Properties&gt;
  &lt;ThresholdFilter level="debug"/&gt;

  &lt;Appenders&gt;
    &lt;Console name="STDOUT"&gt;
      &lt;PatternLayout pattern="%m%n"/&gt;
      &lt;ThresholdFilter level="debug"/&gt;
    &lt;/Console&gt;
    &lt;Routing name="Routing"&gt;
      &lt;Routes pattern="$${sd:type}"&gt;
        &lt;Route&gt;
          &lt;RollingFile name="Rolling-${sd:type}" fileName="${filename}"
                       filePattern="target/rolling1/test1-${sd:type}.%i.log.gz"&gt;
            &lt;PatternLayout&gt;
              &lt;pattern&gt;%d %p %c{1.} [%t] %m%n&lt;/pattern&gt;
            &lt;/PatternLayout&gt;
            &lt;SizeBasedTriggeringPolicy size="500" /&gt;
          &lt;/RollingFile&gt;
        &lt;/Route&gt;
        &lt;Route ref="STDOUT" key="Audit"/&gt;
      &lt;/Routes&gt;
    &lt;/Routing&gt;
  &lt;/Appenders&gt;

  &lt;Loggers&gt;
    &lt;Logger name="EventLogger" level="info" additivity="false"&gt;
      &lt;AppenderRef ref="Routing"/&gt;
    &lt;/Logger&gt;

    &lt;Root level="error"&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>During startup this configuration produces:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2011-11-23 17:08:00,769 DEBUG Generated plugins in 0.003374000 seconds
2011-11-23 17:08:00,789 DEBUG Calling createProperty on class org.apache.logging.log4j.core.config.Property for element property with params(name="filename", value="target/rolling1/rollingtest-${sd:type}.log")
2011-11-23 17:08:00,792 DEBUG Calling configureSubstitutor on class org.apache.logging.log4j.core.config.PropertiesPlugin for element properties with params(properties={filename=target/rolling1/rollingtest-${sd:type}.log})
2011-11-23 17:08:00,794 DEBUG Generated plugins in 0.001362000 seconds
2011-11-23 17:08:00,797 DEBUG Calling createFilter on class org.apache.logging.log4j.core.filter.ThresholdFilter for element ThresholdFilter with params(level="debug", onMatch="null", onMismatch="null")
2011-11-23 17:08:00,800 DEBUG Calling createLayout on class org.apache.logging.log4j.core.layout.PatternLayout for element PatternLayout with params(pattern="%m%n", Configuration(RoutingTest), null, charset="null")
2011-11-23 17:08:00,802 DEBUG Generated plugins in 0.001349000 seconds
2011-11-23 17:08:00,804 DEBUG Calling createAppender on class org.apache.logging.log4j.core.appender.ConsoleAppender for element Console with params(PatternLayout(%m%n), null, target="null", name="STDOUT", ignoreExceptions="null")
2011-11-23 17:08:00,804 DEBUG Calling createFilter on class org.apache.logging.log4j.core.filter.ThresholdFilter for element ThresholdFilter with params(level="debug", onMatch="null", onMismatch="null")
2011-11-23 17:08:00,813 DEBUG Calling createRoute on class org.apache.logging.log4j.core.appender.routing.Route for element Route with params(AppenderRef="null", key="null", Node=Route)
2011-11-23 17:08:00,823 DEBUG Calling createRoute on class org.apache.logging.log4j.core.appender.routing.Route for element Route with params(AppenderRef="STDOUT", key="Audit", Node=Route)
2011-11-23 17:08:00,825 DEBUG Calling createRoutes on class org.apache.logging.log4j.core.appender.routing.Routes for element Routes with params(pattern="${sd:type}", routes={Route(type=dynamic default), Route(type=static Reference=STDOUT key='Audit')})
2011-11-23 17:08:00,827 DEBUG Calling createAppender on class org.apache.logging.log4j.core.appender.routing.RoutingAppender for element Routing with params(name="Routing", ignoreExceptions="null", Routes({Route(type=dynamic default),Route(type=static Reference=STDOUT key='Audit')}), Configuration(RoutingTest), null, null)
2011-11-23 17:08:00,827 DEBUG Calling createAppenders on class org.apache.logging.log4j.core.config.AppendersPlugin for element appenders with params(appenders={STDOUT, Routing})
2011-11-23 17:08:00,828 DEBUG Calling createAppenderRef on class org.apache.logging.log4j.core.config.plugins.AppenderRefPlugin for element AppenderRef with params(ref="Routing")
2011-11-23 17:08:00,829 DEBUG Calling createLogger on class org.apache.logging.log4j.core.config.LoggerConfig for element logger with params(additivity="false", level="info", name="EventLogger", AppenderRef={Routing}, null)
2011-11-23 17:08:00,830 DEBUG Calling createAppenderRef on class org.apache.logging.log4j.core.config.plugins.AppenderRefPlugin for element AppenderRef with params(ref="STDOUT")
2011-11-23 17:08:00,831 DEBUG Calling createLogger on class org.apache.logging.log4j.core.config.LoggerConfig$RootLogger for element root with params(additivity="null", level="error", AppenderRef={STDOUT}, null)
2011-11-23 17:08:00,833 DEBUG Calling createLoggers on class org.apache.logging.log4j.core.config.LoggersPlugin for element loggers with params(loggers={EventLogger, root})
2011-11-23 17:08:00,834 DEBUG Reconfiguration completed
2011-11-23 17:08:00,846 DEBUG Calling createLayout on class org.apache.logging.log4j.core.layout.PatternLayout for element PatternLayout with params(pattern="%d %p %c{1.} [%t] %m%n", Configuration(RoutingTest), null, charset="null")
2011-11-23 17:08:00,849 DEBUG Calling createPolicy on class org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy for element SizeBasedTriggeringPolicy with params(size="500")
2011-11-23 17:08:00,851 DEBUG Calling createAppender on class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile with params(fileName="target/rolling1/rollingtest-Unknown.log", filePattern="target/rolling1/test1-Unknown.%i.log.gz", append="null", name="Rolling-Unknown", bufferedIO="null", immediateFlush="null", SizeBasedTriggeringPolicy(SizeBasedTriggeringPolicy(size=500)), null, PatternLayout(%d %p %c{1.} [%t] %m%n), null, ignoreExceptions="null")
2011-11-23 17:08:00,858 DEBUG Generated plugins in 0.002014000 seconds
2011-11-23 17:08:00,889 DEBUG Reconfiguration started for context sun.misc.Launcher$AppClassLoader@37b90b39
2011-11-23 17:08:00,890 DEBUG Generated plugins in 0.001355000 seconds
2011-11-23 17:08:00,959 DEBUG Generated plugins in 0.001239000 seconds
2011-11-23 17:08:00,961 DEBUG Generated plugins in 0.001197000 seconds
2011-11-23 17:08:00,965 WARN No Loggers were configured, using default
2011-11-23 17:08:00,976 DEBUG Reconfiguration completed</pre>
</div>
</div>
<div class="paragraph">
<p>If the status attribute is set to error then only error messages will be
written to the console. This makes troubleshooting configuration errors
possible. As an example, if the configuration above is changed to have
the status set to error and the logger declaration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="EventLogger" level="info" additivity="false"&gt;
  &lt;AppenderRef ref="Routng"/&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>the following error message will be produced.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2011-11-24 23:21:25,517 ERROR Unable to locate appender Routng for logger EventLogger</pre>
</div>
</div>
<div class="paragraph">
<p>Applications may wish to direct the status output to some other
destination. This can be accomplished by setting the dest attribute to
either "err" to send the output to stderr or to a file location or URL.
This can also be done by insuring the configured status is set to OFF
and then configuring the application programmatically such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatusConsoleListener listener = new StatusConsoleListener(Level.ERROR);
StatusLogger.getLogger().registerListener(listener);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UnitTestingInMaven"><a class="anchor" href="#UnitTestingInMaven"></a>Testing in Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maven can run unit and functional tests during the build cycle. By
default, any files placed in <code>src/test/resources</code> are automatically
copied to target/test-classes and are included in the classpath during
execution of any tests. As such, placing a log4j2-test.xml into this
directory will cause it to be used instead of a log4j2.xml or
log4j2.json that might be present. Thus a different log configuration
can be used during testing than what is used in production.</p>
</div>
<div class="paragraph">
<p>A second approach, which is extensively used by Log4j 2, is to set the
log4j2.configurationFile property in the method annotated with
@BeforeClass in the junit test class. This will allow an arbitrarily
named file to be used during the test.</p>
</div>
<div class="paragraph">
<p>A third approach, also used extensively by Log4j 2, is to use the
<code>LoggerContextRule</code> JUnit test rule which provides additional
convenience methods for testing. This requires adding the <code>log4j-core</code>
<code>test-jar</code> dependency to your test scope dependencies. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AwesomeTest {
    @Rule
    public LoggerContextRule init = new LoggerContextRule("MyTestConfig.xml");

    @Test
    public void testSomeAwesomeFeature() {
        final LoggerContext ctx = init.getLoggerContext();
        final Logger logger = init.getLogger("org.apache.logging.log4j.my.awesome.test.logger");
        final Configuration cfg = init.getConfiguration();
        final ListAppender app = init.getListAppender("List");
        logger.warn("Test message");
        final List&lt;LogEvent&gt; events = app.getEvents();
        // etc.
    }
}</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Copyright  1999-2024 <a href="https://www.apache.org/">The Apache Software Foundation</a>.
    Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache Software License, Version 2.0</a>.
    Please read our <a href="https://privacy.apache.org/policies/privacy-policy-public.html">privacy policy</a>.
  </p>
  <p>
    Apache, Log4j, and the Apache feather logo are trademarks or registered trademarks of The Apache Software Foundation.
    Oracle and Java are registered trademarks of Oracle and/or its affiliates.
    Other names may be trademarks of their respective owners.
  </p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<!-- `@asciidoctor/tabs` extension scripts -->
<script async src="../_/js/vendor/tabs.js"></script>
  </body>
</html>
